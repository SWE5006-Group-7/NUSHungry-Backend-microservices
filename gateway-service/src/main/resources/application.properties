# ==========================================
# Gateway Service Configuration
# ==========================================

# Server Configuration
spring.application.name=gateway-service
server.port=8080

# Spring Cloud Config Import (required for Spring Cloud 2020.0+)
spring.config.import=optional:configserver:${CONFIG_SERVER_URI:http://localhost:8888}

# ==========================================
# Service Discovery (Eureka Client)
# ==========================================
eureka.client.service-url.defaultZone=http://eureka:eureka@localhost:8761/eureka/
eureka.instance.prefer-ip-address=true
eureka.instance.lease-renewal-interval-in-seconds=30
eureka.instance.lease-expiration-duration-in-seconds=90
eureka.client.registry-fetch-interval-seconds=30

# ==========================================
# Gateway Routes Configuration (Service Discovery)
# ==========================================
# Routes use lb:// (LoadBalancer) to discover services via Eureka

# Admin Service Routes
spring.cloud.gateway.routes[0].id=admin-service
spring.cloud.gateway.routes[0].uri=lb://admin-service
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/admin/**
spring.cloud.gateway.routes[0].filters[0]=StripPrefix=1

# Cafeteria Service Routes
spring.cloud.gateway.routes[1].id=cafeteria-service
spring.cloud.gateway.routes[1].uri=lb://cafeteria-service
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/cafeterias/**,/api/stalls/**
spring.cloud.gateway.routes[1].filters[0]=StripPrefix=1

# Review Service Routes
spring.cloud.gateway.routes[2].id=review-service
spring.cloud.gateway.routes[2].uri=lb://review-service
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/reviews/**
spring.cloud.gateway.routes[2].filters[0]=StripPrefix=1

# Media Service Routes
spring.cloud.gateway.routes[3].id=media-service
spring.cloud.gateway.routes[3].uri=lb://media-service
spring.cloud.gateway.routes[3].predicates[0]=Path=/media/**,/api/upload/**
spring.cloud.gateway.routes[3].filters[0]=StripPrefix=0

# Preference Service Routes
spring.cloud.gateway.routes[4].id=preference-service
spring.cloud.gateway.routes[4].uri=lb://preference-service
spring.cloud.gateway.routes[4].predicates[0]=Path=/api/favorites/**,/api/search-history/**
spring.cloud.gateway.routes[4].filters[0]=StripPrefix=1

# ==========================================
# Redis Configuration (for rate limiting)
# ==========================================
spring.data.redis.host=localhost
spring.data.redis.port=6379
spring.data.redis.password=
spring.data.redis.timeout=60000

# ==========================================
# JWT Configuration
# ==========================================
jwt.secret=${JWT_SECRET:nushungry-secret-key-change-this-in-production-environment}
jwt.expiration=86400000

# ==========================================
# CORS Configuration
# ==========================================
# Handled programmatically in CorsConfig.java

# ==========================================
# Actuator Configuration
# ==========================================
management.endpoints.web.exposure.include=health,info,metrics,gateway
management.endpoint.health.show-details=always
management.endpoint.gateway.enabled=true

# ==========================================
# Circuit Breaker Configuration
# ==========================================
resilience4j.circuitbreaker.configs.default.slidingWindowSize=10
resilience4j.circuitbreaker.configs.default.minimumNumberOfCalls=5
resilience4j.circuitbreaker.configs.default.failureRateThreshold=50
resilience4j.circuitbreaker.configs.default.waitDurationInOpenState=10000
resilience4j.circuitbreaker.configs.default.permittedNumberOfCallsInHalfOpenState=3

# ==========================================
# Springdoc OpenAPI Configuration
# ==========================================
springdoc.api-docs.enabled=true
springdoc.swagger-ui.enabled=true
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.urls[0].name=Admin Service
springdoc.swagger-ui.urls[0].url=http://localhost:8082/v3/api-docs
springdoc.swagger-ui.urls[1].name=Cafeteria Service
springdoc.swagger-ui.urls[1].url=http://localhost:8083/v3/api-docs
springdoc.swagger-ui.urls[2].name=Review Service
springdoc.swagger-ui.urls[2].url=http://localhost:8084/v3/api-docs
springdoc.swagger-ui.urls[3].name=Media Service
springdoc.swagger-ui.urls[3].url=http://localhost:8085/v3/api-docs
springdoc.swagger-ui.urls[4].name=Preference Service
springdoc.swagger-ui.urls[4].url=http://localhost:8086/v3/api-docs

# ==========================================
# Logging Configuration
# ==========================================
logging.level.org.springframework.cloud.gateway=DEBUG
logging.level.reactor.netty.http.client=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
